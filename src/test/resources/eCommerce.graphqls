
# 指令定义
#directive @map(mapper: String) on FIELD
#directive @node(name: String, transform: String) on FIELD
#directive @link(node:String, argument:String) on FIELD

type Query {
    userInfo(id: Int):User
    userInfoList(ids: [Int]): [User]
    coupon(id: Int): Coupon
    couponList(ids: [Int]): [Coupon]
    item(id: Int): ItemBaseInfo
    itemList(ids:[Int], ignore: String): [ItemBaseInfo]
    itemStockList(ids:[Int]):  [ItemStockInfo]
}

type User{
    userId: Int
    age: Int
    name: String
    email: String
    favoriteItemId: Int
    preferredItemIdList: [Int]
    acquiredCouponIdList: [Int]
}

type ItemBaseInfo{
    itemId: Int
    name: String
    salePrice: Int
    withCouponIdList: [Int]
    skuList: [Int]
    # 数据源默认没有该字段返回
    # 需要使用itemId从ItemStockInfoMap中获取
    stockAmount: Int
}

type ItemStockInfo{
    itemId: Int
    stockAmount: Int
}

type Sku{
    skuId: Int
    itemId:Int
    color: String
    size: Int
}

type Coupon{
    couponId: Int
    price: Int
    limitation: Int
    couponText: String
}


#query($itemId:Int) {
#    item(id: $itemId){
#        itemId @filter(predicate:"1==1")
#        name
#    }
#}

#query($userId:Int){
#    userInfo(id:$userId){
#        preferredItemIdList @node(name:"ids")
#        acquiredCouponIdList @node(name:"ids")
#    }
#
#    itemList(ids: 1) @link(argument:"ids",node:"ids"){
#        name @cache()
#    }
#
#    couponList(ids: 1) @link(argument:"ids",node:"ids"){
#        price
#    }
#}


#query($userId:Int){
#    userInfo(id:$userId){
#        age
#        name
#        preferredItemIdList @node(name:"itemIds")
#        acquiredCouponIdList @node(name:"couponIds")
#    }
#
#    itemList(ids:1) @link(argument:"ids",node:"itemIds"){
#        name
#        salePrice
#        withCouponIdList
#    }
#
#    couponList(ids:1) @link(argument:"ids",node:"couponIds"){
#        couponId
#        price
#        changedPrice: price @map(mapper: "price +1")
#    }
#}


# fixme 通过node-path取值
#query($itemIdList:[Int]){
#    itemList(ids:$itemIdList) @node(name:"couponIds",path:"withCouponIdList"){
#        withCouponIdList
#    }
#
#    couponList(ids:1) @link(argument:"ids",node:"couponIds"){
#        id
#        price
#    }
#}

#query($itemId:Int) {
#    item(id: $itemId){
#        itemId
#        name
#        priceText: name @map(mapper:"'售价'+str(salePrice/100)+'元'")
#    }
#}

#query($userIds: [Int]){
#    userInfoList(ids:$userIds){
#        userId
#        name
#        favoriteItemId @node(name:"itemIds")
#    }
#    itemList(ids: 1)@link(argument:"ids",node:"itemIds"){
#        itemId
#        name
#    }
#}

#query{
#    userInfoList(ids: [1,2,3]) @sortBy(key: "id"){
#        userId
#        name
#        favoriteItemId
#    }
#}

# 跨数据源计算例子
#query ($itemIds:[Int]){
#    itemStockList(ids: $itemIds) @node(name:"stockInfoList",transform: "toMap(itemId)")
#    {
#        itemId
#        stockAmount
#    }
#    itemList(ids: $itemIds){
#        itemId
#        name
#        stockAmount @map(mapper: " seq.get(findOne(node('stockInfoList'),'itemId','itemId'),'stockAmount') ")
#    }
#
#}